var InputManager,InventoryManager,LanguageManager,NovelManager,Parser,SceneManager,SoundManager,TextPrinter,UI,Util,novelData,novelPath,indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};NovelManager=function(){function e(){return t?t:void(t=this)}var t;return t=null,e.loadCookie=function(e){var t,n,s,a;for(a=e+"=",n=document.cookie.split(";"),s=0;s<n.length;){for(t=n[s];" "===t.charAt(0);)t=t.substring(1);if(0===t.indexOf(a))return t.substring(a.length,t.length);s++}},e.saveCookie=function(e,t,n){var s,a;return s=new Date,s.setTime(s.getTime()+24*n*60*60*1e3),a="expires="+s.toUTCString(),document.cookie=e+"="+t+"; "+a+"; path=/"},e.loadData=function(e,t){var n,s;if(void 0===t&&(t=!0),void 0===e){if(""!==this.loadCookie("gameData"))return console.log("Cookie found!"),n=this.loadCookie("gameData"),console.log("Cookie loaded"),console.log(n),s=JSON.parse(atob(this.loadCookie("gameData"))),this.prepareLoadedData(s,t)}else if(void 0!==e&&""!==e)return s=JSON.parse(atob(e)),this.prepareLoadedData(s,t)},e.prepareLoadedData=function(e,t){return novelData.novel.name!==e.name?void console.error("ERROR! novel name mismatch"):(novelData.novel.version!==e.version&&console.warn("WARNING! novel version mismatch"),novelData.novel.inventories=e.inventories,novelData.debugMode=novelData.novel.debugMode,SoundManager.init(),t?SceneManager.updateScene(e.currentScene,!0):void 0)},e.saveDataAsJson=function(){var e,t;return t=JSON.parse(JSON.stringify(novelData.novel)),delete t.scenes,delete t.tagPresets,delete t.sounds,delete t.externalText,delete t.externalJson,e=btoa(JSON.stringify(t))},e.saveData=function(){var e;return e=this.saveDataAsJson(),"cookie"===novelData.novel.settings.saveMode?this.saveCookie("novelData",e,365):"text"===novelData.novel.settings.saveMode?UI.showSaveNotification(e):void 0},e.prepareData=function(e){var t,n,s,a,r,i,o,l,u,c,d,v,p,g,f;for(e.currentScene="",e.parsedChoices="",void 0===e.currentInventory&&(e.currentInventory=0),void 0===e.inventories&&(e.inventories=[[]]),console.log(e.inventories[0]),0===e.inventories.length&&(e.inventories[0]=[]),void 0===e.scenes&&(e.scenes=[{}]),void 0===e.tagPresets&&(e.tagPresets=[]),void 0===e.sounds&&(e.sounds=[]),v=e.inventories,a=0,i=v.length;i>a;a++)for(n=v[a],r=0,o=n.length;o>r;r++)s=n[r],void 0===s.displayName&&(s.displayName=s.name);for(p=e.scenes,c=0,l=p.length;l>c;c++)for(f=p[c],f.combinedText="",f.parsedText="",f.visited=!1,void 0===f.text&&(console.warn("WARNING! scene "+f.name+" has no text"),f.text=""),void 0===f.choices&&(console.warn("WARNING! scene "+f.name+" has no choices"),f.choices=[]),g=f.choices,d=0,u=g.length;u>d;d++)t=g[d],t.parsedText="",void 0===t.alwaysShow&&(t.alwaysShow=!1);return void 0===e.settings&&(e.settings={}),void 0===e.settings.debugMode&&(e.settings.debugMode=!1),void 0===e.settings.saveMode&&(e.settings.saveMode="text"),void 0===e.settings.language&&(e.settings.language="english"),void 0===e.settings.showSaveButtons&&(e.settings.showSaveButtons=!0),void 0===e.settings.showSkipButton&&(e.settings.showSkipButton=!1),void 0===e.settings.inventoryHidden&&(e.settings.inventoryHidden=!1),void 0===e.settings.choicesHidden&&(e.settings.choicesHidden=!1),void 0===e.settings.alwaysShowDisabledChoices&&(e.settings.alwaysShowDisabledChoices=!1),void 0===e.settings.floatPrecision&&(e.settings.floatPrecision=5),void 0===e.settings.scrollSettings&&(e.settings.scrollSettings={}),void 0===e.settings.scrollSettings.defaultScrollSpeed&&(e.settings.scrollSettings.defaultScrollSpeed=60),void 0===e.settings.scrollSettings.revisitSkipEnabled&&(e.settings.scrollSettings.revisitSkipEnabled=!0),void 0===e.settings.scrollSettings.textSkipEnabled&&(e.settings.scrollSettings.textSkipEnabled=!0),void 0===e.settings.scrollSettings.skipWithKeyboard&&(e.settings.scrollSettings.skipWithKeyboard=!1),void 0===e.settings.scrollSettings.continueWithKeyboard&&(e.settings.scrollSettings.continueWithKeyboard=!0),void 0===e.settings.scrollSettings.fastScrollWithKeyboard&&(e.settings.scrollSettings.fastScrollWithKeyboard=!0),void 0===e.settings.scrollSettings.fastScrollSpeedMultiplier&&(e.settings.scrollSettings.fastScrollSpeedMultiplier=20),void 0===e.settings.scrollSettings.tickFreqThreshold&&(e.settings.scrollSettings.tickFreqThreshold=100),void 0===e.settings.soundSettings&&(e.settings.soundSettings={}),void 0===e.settings.soundSettings.soundVolume&&(e.settings.soundSettings.soundVolume=.5),void 0===e.settings.soundSettings.musicVolume&&(e.settings.soundSettings.musicVolume=.4),void 0===e.uiText?e.uiText=JSON.parse('[ {"name": "saveText", "language": "english", "content": "Copy and save your save data:" }, {"name": "loadText", "language": "english", "content": "Paste your save data here:" }, {"name": "closeButton", "language": "english", "content": "Close" }, {"name": "copyButton", "language": "english", "content": "Copy" }, {"name": "saveButton", "language": "english", "content": "Save" }, {"name": "loadButton", "language": "english", "content": "Load" }, {"name": "skipButton", "language": "english", "content": "Skip" }, {"name": "continueButton", "language": "english", "content": "Continue" }, {"name": "inventoryTitle", "language": "english", "content": "Inventory:" }, {"name": "hiddenInventoryTitle", "language": "english", "content": "Stats:" } ]'):void 0},e.start=function(){return console.log("-- Starting Novel.js... --"),this.loadMainJson()},e.loadMainJson=function(){var t;return console.log("Loading main json..."),t=new XMLHttpRequest,t.open("GET",novelPath+"/novel.json",!0),t.onload=function(){var n;return t.status>=200&&t.status<400?(n=JSON.parse(t.responseText),e.loadExternalJson(n)):void 0},t.onerror=function(){},t.send(),UI.showContinueButton(!1)},e.loadExternalJson=function(t){var n,s,a,r,i,o;if(console.log("Loading external json files..."),void 0===t.externalJson)return e.includeJsons(t,t),void e.loadExternalText(t);if(0===t.externalJson.length)return e.includeJsons(t,t),void e.loadExternalText(t);for(a=0,r=t.externalJson,i=[],n=0,s=r.length;s>n;n++)o=r[n],i.push(function(n){var s;return s=new XMLHttpRequest,s.open("GET",novelPath+"/json/"+n.file,!0),s.onload=function(){return s.status>=200&&s.status<400&&(n.content=JSON.parse(s.responseText),a++,a===t.externalJson.length)?(e.includeJsons(t,t),e.loadExternalText(t)):void 0},s.onerror=function(){},s.send()}(o));return i},e.includeJsons=function(e,t){var n,s,a;if(void 0!==e.externalJson){s=[];for(a in t)"object"==typeof t[a]&&this.includeJsons(e,t[a]),void 0!==t[a].include?s.push(function(){var s,r,i,o;for(i=e.externalJson,o=[],s=0,r=i.length;r>s;s++){if(n=i[s],n.name===t[a].include){t[a]=n.content,this.includeJsons(e,t[a]);break}o.push(void 0)}return o}.call(this)):s.push(void 0);return s}},e.loadExternalText=function(t){var n,s,a,r,i,o;if(console.log("Loading external text files..."),void 0===t.externalText)return void e.loadExternalCsv(t);if(0===t.externalText.length)return void e.loadExternalCsv(t);for(a=0,r=t.externalText,i=[],n=0,s=r.length;s>n;n++)o=r[n],i.push(function(n){var s;return s=new XMLHttpRequest,s.open("GET",novelPath+"/texts/"+n.file,!0),s.onload=function(){return s.status>=200&&s.status<400&&(n.content=s.responseText,a++,a===t.externalText.length)?e.loadExternalCsv(t):void 0},s.onerror=function(){},s.send()}(o));return i},e.loadExternalCsv=function(t){var n,s,a,r,i,o;if(novelData.csvEnabled){if(console.log("Loading external CSV files..."),void 0===t.externalText)return void e.prepareLoadedJson(t);if(0===t.externalText.length)return void e.prepareLoadedJson(t);for(a=0,r=t.externalCsv,i=[],n=0,s=r.length;s>n;n++)o=r[n],i.push(Papa.parse(novelPath+"/csv/"+o.file,{download:!0,header:!0,comments:"#",complete:function(n){return void 0===novelData.csvData?novelData.csvData=n.data:novelData.csvData=Util.mergeObjArrays(novelData.csvData,n.data),a++,a===t.externalCsv.length?e.prepareLoadedJson(t):void 0}}));return i}return e.prepareLoadedJson(t)},e.prepareLoadedJson=function(e){return this.prepareData(e),novelData.novel=e,novelData.debugMode=novelData.novel.debugMode,SoundManager.init(),UI.init(),novelData.novel.currentScene=SceneManager.changeScene(novelData.novel.scenes[0].name),novelData.status="Ready",console.log("-- Loading Novel.js complete! --")},e}(),InputManager=function(){function e(){return t?t:void(t=this)}var t;return t=null,e.presses=0,e.keyDown=function(e){return this.formsSelected()?void 0:13===e||32===e?(novelData.novel.settings.scrollSettings.continueWithKeyboard&&SceneManager.tryContinue(),novelData.novel.settings.scrollSettings.skipWithKeyboard&&TextPrinter.trySkip(),TextPrinter.unpause()):void 0},e.keyPressed=function(e){return this.formsSelected()?void 0:(this.presses++,(13===e||32===e)&&this.presses>2&&novelData.novel.settings.scrollSettings.fastScrollWithKeyboard?TextPrinter.fastScroll():void 0)},e.keyUp=function(e){return this.formsSelected()?void 0:(this.presses=0,13===e||32===e?TextPrinter.stopFastScroll():void 0)},e.formsSelected=function(){var e,t,n,s,a;if(a=document.getElementById("novel-area"))for(t=a.querySelectorAll("input"),n=0,s=t.length;s>n;n++)if(e=t[n],e===document.activeElement)return!0;return!1},e}(),document.onkeydown=function(e){var t;return e=e||window.event,t=e.keyCode||e.which,InputManager.keyDown(t)},document.onkeypress=function(e){var t;return e=e||window.event,t=e.keyCode||e.which,InputManager.keyPressed(t)},document.onkeyup=function(e){var t;return e=e||window.event,t=e.keyCode||e.which,InputManager.keyUp(t)},Parser=function(){function Parser(){return instance?instance:void(instance=this)}var instance;return instance=null,Parser.selectRandomOption=function(e){var t,n,s,a,r;if(Util.checkFormat(e,"string"),r=e.split("|"),1===r.length)return r[0];for(a=[],n=0,s=r.length;s>n;n++)t=r[n],t=t.split(","),a.push(t);return a=this.chooseRandomly(a)},Parser.chooseRandomly=function(e){var t,n,s,a,r,i,o,l,u,c,d,v,p,g;for(u=[],t=[],v=[],d=0,s=0,r=e.length;r>s;s++)n=e[s],u.push(n[0]),d=parseFloat(n[1])+d,t.push(d),v.push(parseFloat(n[1]));for(p=0,a=0,i=v.length;i>a;a++)n=v[a],p+=parseFloat(n);for(1!==p&&console.error("ERROR: Invalid scene or choice odds (should add up to exactly 1)!"),g=Math.random(),l=0,c=0,o=t.length;o>c;c++){if(n=t[c],n>g)return u[l];l++}},Parser.parseItems=function(e){var t,n,s,a,r;if(Util.checkFormat(e,"string"),""!==e){for(r=e.split("|"),a=[],n=0,s=r.length;s>n;n++)t=r[n],t=t.split(","),a.push(t);return a}},Parser.parseText=function(e){var t,n,s,a,r,i,o,l,u,c,d,v,p,g,f,h,m,S,y,x,T,b,I,D,M,k,P,C,E,N,B,O,L,U,w;if(void 0!==e){for(Util.checkFormat(e,"string"),Util.validateTagParentheses(e)||console.error("ERROR: Invalid tags in text"),C=e.split("[file "),s=a=1,y=C.length;y>=1?y>=a:a>=y;s=y>=1?++a:--a){if(v="",C[s])for(x=C[s].split(""),r=0,i=x.length;i>r&&(n=x[r],"]"!==n);r++)v+=n;if(v=v.replace(/\s+/g,""),""!==v){for(g=null,T=novelData.novel.externalText,f=0,o=T.length;o>f;f++)if(n=T[f],n.name===v){g=n.content;break}null===g&&(g=LanguageManager.getCorrectLanguageCsvString(v)),null!==g&&(e=e.split("[file "+v+"]").join(g))}}for(b=novelData.novel.tagPresets,S=0,l=b.length;l>S;S++)n=b[S],N="[p "+n.name+"]",e.indexOf(N)>-1&&(e=e.split(N).join(n.start)),N="[/p "+n.name+"]",e.indexOf(N)>-1&&(e=e.split(N).join(n.end));for(n=E=0;99>=E;n=++E)e=e.split("[s"+n+"]").join('<span class="highlight-'+n+'">');for(e=e.split("[/s]").join("</span>"),e=e.replace(/\/\[/g,"OPEN_BRACKET_REPLACEMENT").replace(/\/\]/g,"CLOSE_BRACKET_REPLACEMENT"),C=e.split(/\[|\]/),s=0,B=0,u=C.length;u>B;B++)k=C[B],C[s]=k.replace(/OPEN_BRACKET_REPLACEMENT/g,"[").replace(/CLOSE_BRACKET_REPLACEMENT/g,"]"),s++;for(P=0,t=0,s=0,s=O=0,I=C.length-1;I>=0?I>=O:O>=I;s=I>=0?++O:--O){if(k=C[s],"if"===k.substring(0,2))m=k.split("if "),this.parseStatement(m[1])?C[s]="":(C[s]='<span style="display:none;">',P++);else if("/if"===k.substring(0,3))P>0?(C[s]="</span>",P--):C[s]="";else if("inv."===k.substring(0,4))for(L=k.substring(4,k.length),C[s]=0,D=novelData.novel.inventories[novelData.novel.currentInventory],U=0,c=D.length;c>U;U++)n=D[U],n.name===L&&(C[s]=n.value);else if("print"===k.substring(0,5))m=k.split("print "),m=this.parseStatement(m[1]),isNaN(parseFloat(m))||(m=parseFloat(m.toFixed(novelData.novel.settings.floatPrecision))),C[s]=m;else if("exec"===k.substring(0,4))m=k.substring(5,k.length),h=novelData.parsedJavascriptCommands.push(m),h--,C[s]='<span class="execute-command com-'+h+'"></span>';else if("pause"===k.substring(0,5))m=k.substring(6,k.length),C[s]='<span class="pause '+m+'"></span>';else if("sound"===k.substring(0,5))m=k.split("sound "),C[s]='<span class="play-sound '+m[1]+'"></span>';else if("/music"===k.substring(0,6))m=k.split("/music "),C[s]='<span class="stop-music '+m[1]+'"></span>';else if("music"===k.substring(0,5))m=k.split("music "),C[s]='<span class="play-music '+m[1]+'"></span>';else if("/speed"===k.substring(0,6))C[s]='<span class="default-speed"></span>';else if("speed"===k.substring(0,5))m=k.split("speed "),C[s]='<span class="set-speed '+m[1]+'"></span>';else if("/scrollSound"===k.substring(0,12))C[s]='<span class="default-scroll-sound"></span>';else if("scrollSound"===k.substring(0,11))m=k.split("scrollSound "),C[s]='<span class="set-scroll-sound '+m[1]+'"></span>';else if("input"===k.substring(0,5)){for(m=k.split("input "),p="",M=novelData.novel.inventories[novelData.novel.currentInventory],w=0,d=M.length;d>w;w++)n=M[w],n.name===m[1]&&(p=n.value);C[s]='<input type="text" value="'+p+'" name="input" class="input-'+m[1]+'" onblur="UI.updateInputs(true)">'}else"choice"===k.substring(0,6)?(m=k.split("choice "),C[s]='<a href="#" onclick="SceneManager.selectChoiceByNameByClicking(event,\''+m[1]+"')\">",t++):"/choice"===k.substring(0,7)&&(t>0?(C[s]="</a>",t--):C[s]="");s++}return e=C.join("")}},Parser.parseStatement=function(s){var found,i,k,l,len,len1,o,parsedString,parsedValues,plus,ref,ref1,result,returnVal,type,val,vals;if(void 0!==s){for(s=s.toString(),Util.checkFormat(s,"string"),Util.validateParentheses(s)||console.error("ERROR: Invalid parentheses in statement"),s=s.replace(/\s+/g,""),parsedString=s.split(/\(|\)|\+|\*|\-|\/|<=|>=|<|>|==|!=|\|\||&&/),parsedValues=[],k=0,len=parsedString.length;len>k;k++)switch(val=parsedString[k],type=this.getStatementType(val)){case"item":for(found=!1,ref=novelData.novel.inventories[novelData.novel.currentInventory],l=0,len1=ref.length;len1>l;l++)i=ref[l],i.name===val.substring(4,val.length)&&(parsedValues.push(i.value),found=!0);found||parsedValues.push(0);break;case"rand":val=val.split("."),vals=val[1].split(","),plus=!0,"minus"===vals[0].substring(0,5)&&(vals[0]=vals[0].substring(5,vals[0].length),plus=!1),"minus"===vals[1].substring(0,5)&&(vals[1]=vals[1].substring(5,vals[1].length),plus=!1),result=plus?Math.random()*vals[1]+vals[0]:Math.random()*vals[1]-vals[0],void 0===vals[2]&&(vals[2]=0),result=0===vals[2]?Math.round(result):parseFloat(result).toFixed(vals[2]),parsedValues.push(result);break;case"var":val=this.findValue(val.substring(4,val.length),!0),val=isNaN(parseFloat(val))?"'"+val+"'":parseFloat(val).toFixed(novelData.novel.settings.floatPrecision),parsedValues.push(val);break;case"float":parsedValues.push(parseFloat(val).toFixed(novelData.novel.settings.floatPrecision));break;case"int":parsedValues.push(parseInt(val));break;case"string":""!==val?parsedValues.push("'"+val+"'"):parsedValues.push("")}for(i=o=0,ref1=parsedString.length-1;ref1>=0?ref1>=o:o>=ref1;i=ref1>=0?++o:--o)""!==parsedString[i]&&""!==parsedValues[i]&&(s=s.replace(new RegExp(parsedString[i],"g"),parsedValues[i]),s=s.replace(new RegExp("''","g"),"'"));return returnVal=eval(s),"true"===returnVal&&(returnVal=!0),"false"===returnVal&&(returnVal=!1),returnVal}},Parser.getStatementType=function(e){var t;return t=null,t="inv."===e.substring(0,4)?"item":"var."===e.substring(0,4)?"var":"rand."===e.substring(0,5)?"rand":isNaN(parseFloat(e))||-1!==e.toString().indexOf(".")?isNaN(parseFloat(e))||-1===e.toString().indexOf(".")?"string":"float":"int"},Parser.findValue=function(e,t){var n,s,a,r,i;for(r=e.split(","),i=t?this.findValueByName(novelData.novel,r[0])[0]:r.length>1?this.findValueByName(novelData.novel,r[0])[0]:this.findValueByName(novelData.novel,r[0])[1],n=s=0,a=r.length-1;a>=0?a>=s:s>=a;n=a>=0?++s:--s)Util.isOdd(n)?i=i[parseInt(r[n])]:0!==n&&(t?("parsedText"!==r[n]&&"text"!==r[n]||(r[n]="parsedText",i.parsedText=this.parseText(i.text)),i=this.findValueByName(i,r[n])[0]):i=this.findValueByName(i,r[n])[1]);return void 0===i&&console.warn("WARNING: Searched value not found."),i},Parser.findValueByName=function(e,t){var n,s,a,r;return Util.checkFormat(t,"string"),a=t.split("."),n=e[a[0]],a[1]?(a.splice(0,1),s=a.join("."),this.findValueByName(n,s)):(r=[],r[0]=n,r[1]=e,r)},Parser}(),InventoryManager=function(){function e(){return t?t:void(t=this)}var t;return t=null,e.checkRequirements=function(e){var t,n,s,a,r,i,o,l;for(Util.checkFormat(e,"array"),l=0,o=novelData.novel.inventories[novelData.novel.currentInventory],s=0,r=o.length;r>s;s++)for(t=o[s],a=0,i=e.length;i>a;a++)n=e[a],n[0]===t.name&&n[1]<=t.value&&(l+=1);return l===e.length},e.setValue=function(e,t){var n,s;return Util.checkFormat(e,"string"),n=this.getValueArrayLast(e),s=Parser.findValue(e,!1),s[n]=t},e.increaseValue=function(e,t){var n,s;return Util.checkFormat(e,"string"),n=this.getValueArrayLast(e),s=Parser.findValue(e,!1),s[n]=s[n]+t,isNaN(parseFloat(s[n]))?void 0:s[n]=parseFloat(s[n].toFixed(novelData.novel.settings.floatPrecision))},e.decreaseValue=function(e,t){var n,s;return Util.checkFormat(e,"string"),n=this.getValueArrayLast(e),s=Parser.findValue(e,!1),s[n]=s[n]-t,isNaN(parseFloat(s[n]))?void 0:s[n]=parseFloat(s[n].toFixed(novelData.novel.settings.floatPrecision))},e.getValueArrayLast=function(e){var t;return t=e.split(","),t=t[t.length-1].split("."),t=t[t.length-1]},e.addItems=function(e){return this.editItems(e,"add")},e.setItems=function(e){return this.editItems(e,"set")},e.removeItems=function(e){return this.editItems(e,"remove")},e.editItems=function(e,t){var n,s,a,r,i,o;for(Util.checkFormat(e,"array"),o=[],r=0,i=e.length;i>r;r++)a=e[r],n=!1,"!"===a[0].substring(0,1)&&(n=!0,a[0]=a[0].substring(1,a[0].length)),s=this.tryEditInInventory(t,a,n),s?o.push(void 0):o.push(this.tryEditNotInInventory(t,a,n));return o},e.tryEditInInventory=function(e,t,n){var s,a,r,i,o,l,u,c;for(u=novelData.novel.inventories[novelData.novel.currentInventory],r=0,i=u.length;i>r;r++)if(a=u[r],a.name===t[0])return o=1,t.length>2?(s=t[2],c=parseInt(Parser.parseStatement(t[1])),isNaN(s)||(o=t[2],s=t.name),t.length>3&&(o=parseFloat(t[2]),s=t[3])):(s=t[0],c=parseInt(Parser.parseStatement(t[1]))),l=Math.random(),o>l&&("set"===e?isNaN(parseInt(t[1]))?a.value=t[1]:a.value=parseInt(t[1]):"add"===e?(isNaN(parseInt(a.value))&&(a.value=0),a.value=parseInt(a.value)+c):"remove"===e&&(isNaN(parseInt(a.value))?a.value=0:(a.value=parseInt(a.value)-c,a.value<0&&(a.value=0))),a.hidden=n),!0;return!1},e.tryEditNotInInventory=function(e,t,n){var s,a,r,i;return"remove"!==e&&(a=1,i=parseInt(Parser.parseStatement(t[1])),isNaN(i)&&(i=Parser.parseStatement(t[1])),t.length>2?(s=t[2],isNaN(s)||(a=t[2],s=t.name),t.length>3&&(a=parseFloat(t[2]),s=t[3])):s=t[0],r=Math.random(),void 0===s&&(s=t[0]),a>r)?novelData.novel.inventories[novelData.novel.currentInventory].push({name:t[0],value:i,displayName:s,hidden:n}):void 0},e}(),LanguageManager=function(){function e(){return t?t:void(t=this)}var t;return t=null,e.setLanguage=function(e){return novelData.novel.settings.language=e,UI.updateUILanguage()},e.getUIString=function(e){var t,n,s,a;for(Util.checkFormat(e,"string"),a=novelData.novel.uiText,n=0,s=a.length;s>n;n++)if(t=a[n],t.name===e&&t.language===novelData.novel.settings.language)return Parser.parseText(t.content);return console.error("Error! UI string "+e+" not found!"),"[NOT FOUND]"},e.getCorrectLanguageCsvString=function(e){var t,n,s,a;if(Util.checkFormat(e,"string"),void 0===novelData.csvData||novelData.csvEnabled===!1)return console.error("Error! CSV data cannot be parsed, because Papa Parse can't be detected."),"[NOT FOUND]";for(a=novelData.csvData,n=0,s=a.length;s>n;n++)if(t=a[n],t.name===e)return void 0===t[novelData.novel.settings.language]?void 0===t.english?(console.error("Error! No CSV value by name "+e+" could be found."),"[NOT FOUND]"):Parser.parseText(t.english):Parser.parseText(t[novelData.novel.settings.language])},e.getItemAttribute=function(e,t){switch(t){case"displayName":return"[csv]"===e.displayName?this.getCorrectLanguageCsvString(e.name+"|displayName"):this.getCorrectLanguageString(e.displayName);case"description":return"[csv]"===e.description?this.getCorrectLanguageCsvString(e.name+"|description"):this.getCorrectLanguageString(e.description);default:return console.error("Error! Trying to get an invalid item attribute in LanguageManager."),"[NOT FOUND]"}},e.getCorrectLanguageString=function(e,t){var n,s,a;if(Util.checkFormat(e,"arrayOrString"),"string"==typeof e)return e;if("[object Array]"===Object.prototype.toString.call(e))for(s=0,a=e.length;a>s;s++)if(n=e[s],n.language===novelData.novel.settings.language)return n.content},e}(),SceneManager=function(){function SceneManager(){return instance?instance:void(instance=this)}var instance;return instance=null,SceneManager.tryContinue=function(){return TextPrinter.printCompleted&&1===TextPrinter.tickSpeedMultiplier?this.selectChoiceByName("Continue"):void 0},SceneManager.selectChoice=function(e){return this.exitScene(novelData.novel.currentScene),this.readItemEdits(e),this.readSounds(e,!0),this.readSaving(e),this.readExecutes(e),this.readCheckpoints(e),this.readLanguage(e),void 0!==e.nextScene?this.changeScene(e.nextScene):void 0!==e.nextChoice?this.selectChoiceByName(Parser.selectRandomOption(e.nextChoice)):this.updateScene(novelData.novel.currentScene,!0),UI.updateInventories()},SceneManager.selectChoiceByNameByClicking=function(e,t){return e.stopPropagation(),e.preventDefault(),this.selectChoiceByName(t)},SceneManager.selectChoiceByName=function(e){var t,n,s,a,r;for(a=novelData.novel.currentScene.choices,r=[],n=0,s=a.length;s>n;n++){if(t=a[n],t.name===e){this.selectChoice(t);break}r.push(void 0)}return r},SceneManager.selectChoiceById=function(e){return novelData.novel.currentScene.choices[e]?this.selectChoice(novelData.novel.currentScene.choices[e]):void 0},SceneManager.exitScene=function(e){return e.visited=!0,UI.updateInputs(!1),UI.resetChoices()},SceneManager.changeScene=function(e){var t;return Util.checkFormat(e,"string"),t=this.findSceneByName(Parser.selectRandomOption(e)),this.setupScene(t),t},SceneManager.setupScene=function(e){return this.updateScene(e,!1),this.readItemEdits(novelData.novel.currentScene),this.readSounds(novelData.novel.currentScene,!1),this.readSaving(novelData.novel.currentScene),this.readExecutes(novelData.novel.currentScene),this.readCheckpoints(novelData.novel.currentScene),this.readLanguage(novelData.novel.currentScene),this.readMisc(novelData.novel.currentScene),UI.showHiddenInventoryArea(),TextPrinter.printText(e.parsedText,!1)},SceneManager.updateScene=function(e,t){return e=this.combineSceneTexts(e),e.parsedText=Parser.parseText(e.combinedText),novelData.novel.currentScene=e,UI.updateStyle(e.style),t?(TextPrinter.printText(e.parsedText,!0),TextPrinter.complete()):novelData.novel.parsedChoices=null},SceneManager.findSceneByName=function(e){var t,n,s,a;for(Util.checkFormat(e,"string"),a=novelData.novel.scenes,n=0,s=a.length;s>n;n++)if(t=a[n],t.name===e)return t;return console.error("ERROR: Scene by name '"+e+"' not found!")},SceneManager.combineSceneTexts=function(e){var t,n,s,a;if(Util.checkFormat(e,"object"),Util.checkFormat(e.text,"arrayOrString"),e.combinedText="","[object Array]"===Object.prototype.toString.call(e.text))for(a=e.text,n=0,s=a.length;s>n;n++)t=a[n],e.combinedText=e.combinedText+"<p>"+LanguageManager.getCorrectLanguageString(t)+"</p>";else e.combinedText=e.text;return e},SceneManager.readItemEdits=function(e){var t,n,s,a,r,i,o,l,u,c,d,v,p,g;if(void 0!==e.changeInventory&&(novelData.novel.currentInventory=Parser.parseStatement(e.changeInventory),novelData.novel.currentInventory>novelData.novel.inventories.length))for(t=n=0,u=novelData.novel.currentInventory;u>=0?u>=n:n>=u;t=u>=0?++n:--n)void 0===novelData.novel.inventories[t]&&(novelData.novel.inventories[t]=[]);if(void 0!==e.removeItem&&InventoryManager.removeItems(Parser.parseItems(e.removeItem)),void 0!==e.addItem&&InventoryManager.addItems(Parser.parseItems(e.addItem)),void 0!==e.setItem&&InventoryManager.setItems(Parser.parseItems(e.setItem)),void 0!==e.setValue)for(c=e.setValue,s=0,a=c.length;a>s;s++)g=c[s],InventoryManager.setValue(g.path,Parser.parseStatement(g.value.toString()));if(void 0!==e.increaseValue)for(d=e.increaseValue,o=0,r=d.length;r>o;o++)g=d[o],InventoryManager.increaseValue(g.path,Parser.parseStatement(g.value.toString()));if(void 0!==e.decreaseValue){for(v=e.decreaseValue,p=[],l=0,i=v.length;i>l;l++)g=v[l],p.push(InventoryManager.decreaseValue(g.path,Parser.parseStatement(g.value.toString())));return p}},SceneManager.readSounds=function(e,t){var n;return n=!1,void 0!==e.playSound&&(SoundManager.playSound(Parser.parseStatement(e.playSound),!1),n=!0),t&&!n&&SoundManager.playDefaultClickSound(),void 0!==e.startMusic&&SoundManager.startMusic(Parser.parseStatement(e.startMusic)),void 0!==e.stopMusic&&SoundManager.stopMusic(Parser.parseStatement(e.stopMusic)),void 0!==e.scrollSound?novelData.novel.currentScene.scrollSound=Parser.parseStatement(e.scrollSound):novelData.novel.settings.soundSettings.defaultScrollSound?novelData.novel.currentScene.scrollSound=novelData.novel.settings.soundSettings.defaultScrollSound:novelData.novel.currentScene.scrollSound=void 0},SceneManager.readExecutes=function(source){return void 0!==source.executeJs?eval(source.executeJs):void 0},SceneManager.readLanguage=function(e){return void 0!==e.setLanguage?LanguageManager.setLanguage(e.setLanguage):void 0},SceneManager.readMisc=function(e){var t;return t=void 0!==e.skipEnabled?Parser.parseStatement(e.skipEnabled):novelData.novel.settings.scrollSettings.textSkipEnabled,novelData.novel.currentScene.skipEnabled=t,UI.showSkipButton(t),void 0!==e.revisitSkipEnabled?novelData.novel.currentScene.revisitSkipEnabled=Parser.parseStatement(e.revisitSkipEnabled):novelData.novel.currentScene.revisitSkipEnabled=novelData.novel.settings.scrollSettings.revisitSkipEnabled,void 0!==e.scrollSpeed?novelData.novel.currentScene.scrollSpeed=e.scrollSpeed:novelData.novel.currentScene.scrollSpeed=novelData.novel.settings.scrollSettings.defaultScrollSpeed,t=void 0!==e.inventoryHidden?Parser.parseStatement(e.inventoryHidden):novelData.novel.settings.inventoryHidden,novelData.inventoryHidden=t,UI.showInventoryArea(!t),t=void 0!==e.choicesHidden?Parser.parseStatement(e.choicesHidden):novelData.novel.settings.choicesHidden,novelData.choicesHidden=t,UI.showChoicesArea(!t),t=void 0!==e.saveButtonsHidden?Parser.parseStatement(e.saveButtonsHidden):!novelData.novel.settings.showSaveButtons,novelData.saveButtonsHidden=t,UI.showSaveButtons(!t)},SceneManager.readSaving=function(e){return void 0!==e.save&&NovelManager.saveData(),void 0!==e.load?UI.showLoadNotification():void 0},SceneManager.readCheckpoints=function(e){var t,n,s,a,r,i,o,l,u,c;if(void 0!==e.saveCheckpoint){for(void 0===novelData.novel.checkpoints&&(novelData.novel.checkpoints=[]),n=!1,l=novelData.novel.checkpoints,a=0,i=l.length;i>a;a++)s=l[a],s.name===Parser.parseStatement(e.saveCheckpoint)&&(s.scene=novelData.novel.currentScene.name,n=!0);n||(t={name:Parser.parseStatement(e.saveCheckpoint),scene:novelData.novel.currentScene.name},novelData.novel.checkpoints.push(t))}if(void 0!==e.loadCheckpoint){for(void 0===novelData.novel.checkpoints&&(novelData.novel.checkpoints=[]),u=novelData.novel.checkpoints,c=[],r=0,o=u.length;o>r;r++)s=u[r],s.name===Parser.parseStatement(e.loadCheckpoint)?c.push(this.changeScene(s.scene)):c.push(void 0);return c}},SceneManager.requirementsFilled=function(e){var t,n,s,a,r,i;for(a=[],void 0!==e.itemRequirement&&(r=Parser.parseItems(e.itemRequirement),a.push(InventoryManager.checkRequirements(r))),void 0!==e.requirement&&a.push(Parser.parseStatement(e.requirement)),i=!0,t=0,n=a.length;n>t;t++)s=a[t],s===!1&&(i=!1);return i},SceneManager}(),SoundManager=function(){function e(){return t?t:void(t=this)}var t;return t=null,e.init=function(){var e,t,n,s,a,r;for(e=0,s=novelData.novel.sounds,a=[],t=0,n=s.length;n>t;t++)r=s[t],r.sound=new Audio(novelPath+"/sounds/"+r.file),a.push(e++);return a},e.playDefaultClickSound=function(e,t){return this.playSound(novelData.novel.settings.soundSettings.defaultClickSound,!1)},e.playSound=function(e,t){var n,s,a,r,i;if(void 0!==e)for(e=Parser.selectRandomOption(e),a=novelData.novel.sounds,n=0,s=a.length;s>n;n++)if(r=a[n],r.name===e)return i=r.sound,t?i.volume=novelData.novel.settings.soundSettings.musicVolume:i.volume=novelData.novel.settings.soundSettings.soundVolume,i.play(),i},e.isPlaying=function(e){var t,n,s,a;for(a=novelData.music,n=0,s=a.length;s>n;n++)return t=a[n],!t.paused},e.startMusic=function(e){var t,n,s,a,r;for(r=novelData.music,t=0,n=r.length;n>t;t++)if(s=r[t],s.name===e)return;return a=this.playSound(e,!0),void 0!==a?(a.addEventListener("ended",function(){this.currentTime=0,this.play()},!1),novelData.music.push({name:e,music:a})):void 0},e.stopMusic=function(e){var t,n,s,a,r,i;for(r=novelData.music,i=[],s=0,a=r.length;a>s;s++)t=r[s],e===t.name?(t.music.pause(),n=novelData.music.indexOf(t),i.push(novelData.music.splice(n,1))):i.push(void 0);return i},e}(),TextPrinter=function(){function TextPrinter(){return instance?instance:void(instance=this)}var instance;return instance=null,TextPrinter.fullText="",TextPrinter.currentText="",TextPrinter.currentOffset=0,TextPrinter.defaultInterval=0,TextPrinter.soundBuffer=[],TextPrinter.musicBuffer=[],TextPrinter.stopMusicBuffer=[],TextPrinter.executeBuffer=[],TextPrinter.buffersExecuted=!1,TextPrinter.scrollSound=null,TextPrinter.tickSoundFrequency=1,TextPrinter.tickCounter=0,TextPrinter.tickSpeedMultiplier=1,TextPrinter.speedMod=!1,TextPrinter.pause=0,TextPrinter.interval=0,TextPrinter.printCompleted=!1,TextPrinter.printText=function(e,t){return this.printCompleted=!1,this.currentText="",UI.updateText(this.currentText),UI.disableSkipButton(),UI.showContinueButton(!1),this.fullText=e,this.currentOffset=-1,this.soundBuffer=[],this.musicBuffer=[],this.stopMusicBuffer=[],this.executeBuffer=[],this.buffersExecuted=!1,t&&(this.buffersExecuted=!0),this.defaultInterval=novelData.novel.currentScene.scrollSpeed,this.setTickSoundFrequency(this.defaultInterval),novelData.novel.currentScene.visited&&novelData.novel.currentScene.revisitSkipEnabled?void this.complete():setTimeout(this.onTick(),this.defaultInterval)},TextPrinter.trySkip=function(){return novelData.novel.currentScene.skipEnabled?this.complete():void 0},TextPrinter.complete=function(){var first,i,k,l,len,len1,len2,len3,o,q,ref,ref1,ref2,ref3,ref4,ref5,ref6,ref7,s,ss,t,u,v,w;if(this.printCompleted=!0,this.currentOffset=0,UI.enableSkipButton(),!this.buffersExecuted){if(ss=[],first=!0,this.fullText.indexOf("play-sound")>-1)for(s=this.fullText.split("play-sound "),k=0,len=s.length;len>k;k++)i=s[k],first||ss.push(i.split(/\s|\"/)[0]),first=!1;if(ss.length>0)for(i=l=0,ref=ss.length;ref>=0?ref>=l:l>=ref;i=ref>=0?++l:--l)ref1=ss[i],indexOf.call(this.soundBuffer,ref1)>=0||SoundManager.playSound(Parser.parseStatement(ss[i]));if(ss=[],first=!0,this.fullText.indexOf("play-music")>-1)for(s=this.fullText.split("play-music "),o=0,len1=s.length;len1>o;o++)i=s[o],first||ss.push(i.split(/\s|\"/)[0]),first=!1;if(ss.length>0)for(i=q=0,ref2=ss.length;ref2>=0?ref2>=q:q>=ref2;i=ref2>=0?++q:--q)ref3=ss[i],indexOf.call(this.musicBuffer,ref3)>=0||SoundManager.startMusic(Parser.parseStatement(ss[i]));if(ss=[],first=!0,this.fullText.indexOf("stop-music")>-1)for(s=this.fullText.split("stop-music "),t=0,len2=s.length;len2>t;t++)i=s[t],first||ss.push(i.split(/\s|\"/)[0]),first=!1;if(ss.length>0)for(i=u=0,ref4=ss.length;ref4>=0?ref4>=u:u>=ref4;i=ref4>=0?++u:--u)ref5=ss[i],
indexOf.call(this.stopMusicBuffer,ref5)>=0||SoundManager.stopMusic(Parser.parseStatement(ss[i]));if(ss=[],first=!0,this.fullText.indexOf("execute-command")>-1)for(s=this.fullText.split("execute-command "),v=0,len3=s.length;len3>v;v++)i=s[v],first||ss.push(i.split(/\s|\"/)[0]),first=!1;if(ss.length>0)for(i=w=0,ref6=ss.length;ref6>=0?ref6>=w:w>=ref6;i=ref6>=0?++w:--w)ref7=ss[i],indexOf.call(this.executeBuffer,ref7)>=0||void 0===ss[i]||eval(novelData.parsedJavascriptCommands[parseInt(ss[i].substring(4,ss[i].length))]);this.buffersExecuted=!0}return this.currentText=this.fullText,UI.updateText(this.currentText),UI.updateChoices()},TextPrinter.unpause=function(){return UI.showContinueButton(!1),"input"===this.pause?this.pause=0:void 0},TextPrinter.fastScroll=function(){return novelData.novel.currentScene.skipEnabled?this.tickSpeedMultiplier=novelData.novel.settings.scrollSettings.fastScrollSpeedMultiplier:void 0},TextPrinter.stopFastScroll=function(){return this.tickSpeedMultiplier=1},TextPrinter.setTickSoundFrequency=function(e){var t;return t=novelData.novel.settings.scrollSettings.tickFreqThreshold,this.tickSoundFrequency=1,2*t>=e&&(this.tickSoundFrequency=2),t>=e?this.tickSoundFrequency=3:void 0},TextPrinter.onTick=function(){var e;if("input"!==this.pause&&this.pause>0&&this.pause--,0===this.pause){if(this.speedMod||(this.interval=this.defaultInterval),0===this.defaultInterval)return void this.complete();if(this.currentText===this.fullText)return;for(e=!1;" "===this.fullText[this.currentOffset]||"<"===this.fullText[this.currentOffset]||">"===this.fullText[this.currentOffset];)this.readTags();if(this.currentText=this.fullText.substring(0,this.currentOffset),UI.updateText(this.currentText),e||this.currentOffset++,this.currentOffset>=this.fullText.length)return void this.complete();this.tickCounter++,this.tickCounter>=this.tickSoundFrequency&&"none"!==this.scrollSound&&0!==this.interval&&(null!==this.scrollSound?SoundManager.playSound(this.scrollSound):void 0!==novelData.novel.currentScene.scrollSound&&SoundManager.playSound(novelData.novel.currentScene.scrollSound),this.tickCounter=0)}return this.setTickSoundFrequency(this.interval/this.tickSpeedMultiplier),setTimeout(function(){TextPrinter.onTick()},this.interval/this.tickSpeedMultiplier)},TextPrinter.readTags=function(){var disp,i,s,spans,str;if(" "===this.fullText[this.currentOffset]&&this.currentOffset++,">"===this.fullText[this.currentOffset]&&this.currentOffset++,"<"===this.fullText[this.currentOffset]){for(i=this.currentOffset,str="",i++;">"!==this.fullText[i-1]&&"<"!==this.fullText[i];)str+=this.fullText[i],i++;if(str=str.substring(1,str.length),str.indexOf("display:none;")>-1){for(disp="",spans=1;;)if(i++,disp+=this.fullText[i],-1!==disp.indexOf("/span")?(spans--,disp=""):-1!==disp.indexOf("span")&&(spans++,disp=""),0===spans)break;i++}return str.indexOf("play-sound")>-1&&str.indexOf("display:none;")>-1&&(s=str.split("play-sound "),s=s[1].split(/\s|\"/)[0],this.soundBuffer.push(Parser.parseStatement(s))),str.indexOf("play-music")>-1&&str.indexOf("display:none;")>-1&&(s=str.split("play-music "),s=s[1].split(/\s|\"/)[0],this.musicBuffer.push(Parser.parseStatement(s))),str.indexOf("stop-music")>-1&&str.indexOf("display:none;")>-1&&(s=str.split("stop-music "),s=s[1].split(/\s|\"/)[0],this.stopMusicBuffer.push(Parser.parseStatement(s))),str.indexOf("execute-command")>-1&&str.indexOf("display:none;")>-1&&(s=str.split("execute-command "),s=s[1].split(/\s|\"/)[0],this.executeBuffer.push(Parser.parseStatement(s))),-1===str.indexOf("display:none;")&&(str.indexOf("play-sound")>-1&&(s=str.split("play-sound "),s=s[1].split(/\s|\"/)[0],this.soundBuffer.push(Parser.parseStatement(s)),SoundManager.playSound(Parser.parseStatement(s))),str.indexOf("play-music")>-1&&(s=str.split("play-music "),s=s[1].split(/\s|\"/)[0],this.musicBuffer.push(Parser.parseStatement(s)),SoundManager.startMusic(Parser.parseStatement(s))),str.indexOf("stop-music")>-1&&(s=str.split("stop-music "),s=s[1].split(/\s|\"/)[0],this.stopMusicBuffer.push(Parser.parseStatement(s)),SoundManager.stopMusic(Parser.parseStatement(s))),str.indexOf("pause")>-1&&(s=str.split("pause "),s=s[1].split(/\s|\"/)[0],this.pause=s,"input"===this.pause&&UI.showContinueButton(!0)),str.indexOf("execute-command")>-1&&(s=str.split("execute-command "),s=s[1].split(/\s|\"/)[0],this.executeBuffer.push(s),void 0!==s&&eval(novelData.parsedJavascriptCommands[parseInt(s.substring(4,s.length))])),str.indexOf("set-speed")>-1&&(s=str.split("set-speed "),s=s[1].split(/\s|\"/)[0],this.interval=Parser.parseStatement(s),this.speedMod=!0),str.indexOf("default-speed")>-1&&(this.interval=this.defaultInterval,this.speedMod=!1),str.indexOf("set-scroll-sound")>-1&&(s=str.split("set-scroll-sound "),s=s[1].split(/\s|\"/)[0],this.scrollSound=Parser.parseStatement(s)),str.indexOf("default-scroll-sound")>-1&&(this.scrollSound=void 0)),this.currentOffset=i,this.offsetChanged=!0}},TextPrinter}(),UI=function(){function e(){return t?t:void(t=this)}var t;return t=null,e.init=function(){var e,t;t=document.getElementsByTagName("novel")[0],t||(t=document.getElementById("novel-area")),t&&(e=document.createElement("div"),e.id="novel-area",e.innerHTML='<div id="novel-style-area"> <div id="novel-notification-wrapper"> <div id="novel-save-notification" class="novel-notification"> <p class="novel-save-text"></p> <p><textarea name="save-text" readonly></textarea></p> <p><button type="button" class="novel-close-button" onclick="UI.closeSaveNotification()"></button><button type="button" class="novel-copy-button" onclick="UI.copyText()"></button></p> </div> <div id="novel-load-notification" class="novel-notification"> <p class="novel-load-text"></p> <p><textarea name="load-text"></textarea></p> <p><button type="button" class="novel-close-button" onclick="UI.closeLoadNotification(false)"></button><button type="button" class="novel-load-button" onclick="UI.closeLoadNotification(true)"></button></p> </div> </div> <div id="novel-text-area"> <div id="novel-text"></div> <button type="button" class="novel-skip-button" onclick="TextPrinter.complete()"></button> <button type="button" class="novel-continue-button" onclick="TextPrinter.unpause()"></button> </div> <div id="novel-choices-area"> <ul id="novel-choice-list"></ul> </div> <div id="novel-inventory-area"> <h5 class="novel-inventory-title"></h5> <ul id="novel-inventory"></ul> </div> <div id="novel-hidden-inventory-area"> <h5 class="novel-hidden-inventory-title"></h5> <ul id="novel-hidden-inventory"></ul> </div> <div id="novel-save-area"> <button type="button" class="novel-save-button" onclick="NovelManager.saveData()"></button> <button type="button" class="novel-load-button" onclick="UI.showLoadNotification()"></button> </div> </div>',t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t),this.updateUILanguage())},e.updateUILanguage=function(){var e,t,n,s,a,r,i,o;for(document.getElementsByClassName("novel-save-text")[0].innerHTML=LanguageManager.getUIString("saveText"),document.getElementsByClassName("novel-load-text")[0].innerHTML=LanguageManager.getUIString("loadText"),r=document.getElementsByClassName("novel-close-button"),t=0,s=r.length;s>t;t++)e=r[t],e.innerHTML=LanguageManager.getUIString("closeButton");for(document.getElementsByClassName("novel-copy-button")[0].innerHTML=LanguageManager.getUIString("copyButton"),document.getElementsByClassName("novel-skip-button")[0].innerHTML=LanguageManager.getUIString("skipButton"),document.getElementsByClassName("novel-continue-button")[0].innerHTML=LanguageManager.getUIString("continueButton"),document.getElementsByClassName("novel-inventory-title")[0].innerHTML=LanguageManager.getUIString("inventoryTitle"),document.getElementsByClassName("novel-hidden-inventory-title")[0].innerHTML=LanguageManager.getUIString("hiddenInventoryTitle"),document.getElementsByClassName("novel-save-button")[0].innerHTML=LanguageManager.getUIString("saveButton"),i=document.getElementsByClassName("novel-load-button"),o=[],n=0,a=i.length;a>n;n++)e=i[n],o.push(e.innerHTML=LanguageManager.getUIString("loadButton"));return o},e.updateStyle=function(e){var t;return t=document.getElementById("novel-style-area"),void 0===e&&(e=""),t.setAttribute("class",e)},e.disableSkipButton=function(){return null!==document.querySelector(".novel-skip-button")?document.querySelector(".novel-skip-button").disabled=!0:void 0},e.enableSkipButton=function(){return null!==document.querySelector(".novel-skip-button")?document.querySelector(".novel-skip-button").disabled=!0:void 0},e.showSkipButton=function(e){var t;return t=document.getElementsByClassName("novel-skip-button")[0],e&&novelData.novel.settings.showSkipButton?t.style.display="inline":t.style.display="none"},e.showChoicesArea=function(e){var t;return t=document.getElementById("novel-choices-area"),e?t.style.display="inline":t.style.display="none"},e.showInventoryArea=function(e){var t;return t=document.getElementById("novel-inventory-area"),e?t.style.display="inline":t.style.display="none"},e.showHiddenInventoryArea=function(){var e;return e=document.getElementById("novel-hidden-inventory-area"),novelData.novel.settings.debugMode?e.style.display="inline":e.style.display="none"},e.showSaveButtons=function(e){var t;return t=document.getElementById("novel-save-area"),e?t.style.display="inline":t.style.display="none"},e.showContinueButton=function(e){return null!==document.querySelector(".novel-continue-button")?e?document.querySelector(".novel-continue-button").style.display="inline":document.querySelector(".novel-continue-button").style.display="none":void 0},e.updateText=function(e){var t;return t=document.getElementById("novel-text"),t.innerHTML=e},e.showSaveNotification=function(e){var t,n;return t=document.getElementById("novel-save-notification"),n=t.querySelectorAll("textarea"),n[0].value=e,t.style.display="block"},e.closeSaveNotification=function(){var e;return e=document.getElementById("novel-save-notification"),e.style.display="none"},e.showLoadNotification=function(){var e;return"text"===novelData.novel.settings.saveMode?(e=document.getElementById("novel-load-notification"),e.style.display="block"):NovelManager.loadGame()},e.closeLoadNotification=function(e,t){var n,s;return n=document.getElementById("novel-load-notification"),e&&(s=n.querySelectorAll("textarea"),NovelManager.loadData(s[0].value,t),s[0].value=""),n.style.display="none"},e.copyText=function(){var e,t,n,s;e=document.getElementById("novel-save-notification").querySelector("textarea"),e.select();try{return s=document.execCommand("copy")}catch(n){return t=n,console.error("Error! Copying to clipboard failed: "+t)}},e.updateInputs=function(e){var t,n,s,a,r,i;for(s=document.getElementById("novel-area").querySelectorAll("input"),i=[],a=0,r=s.length;r>a;a++)n=s[a],i.push(function(){var s,a,r,i;for(r=novelData.novel.inventories[novelData.novel.currentInventory],i=[],s=0,a=r.length;a>s;s++)t=r[s],t.name===n.className.substring(6,n.className.length)?(t.value=Util.stripHTML(n.value),e?i.push(SceneManager.updateScene(novelData.novel.currentScene,!0)):i.push(void 0)):i.push(void 0);return i}());return i},e.resetChoices=function(){var e,t;for(e=document.getElementById("novel-choice-list"),t=[];e.firstChild;)t.push(e.removeChild(e.firstChild));return t},e.resetInventories=function(){var e,t;for(e=document.getElementById("novel-inventory");e.firstChild;)e.removeChild(e.firstChild);for(e=document.getElementById("novel-hidden-inventory"),t=[];e.firstChild;)t.push(e.removeChild(e.firstChild));return t},e.updateChoices=function(){var e,t,n,s,a,r,i;for(this.resetChoices(),t=document.getElementById("novel-choice-list"),n=0,i=[],n=s=0,r=novelData.novel.currentScene.choices.length;r>=0?r>s:s>r;n=r>=0?++s:--s)e=novelData.novel.currentScene.choices[n],e.text?(e.parsedText=Parser.parseText(LanguageManager.getCorrectLanguageString(e.text)),SceneManager.requirementsFilled(e)?(a=document.createElement("li"),a.innerHTML='<a href="#"; onclick="SceneManager.selectChoiceById('+n+')">'+e.parsedText+"</a>",i.push(t.appendChild(a))):e.alwaysShow||novelData.novel.settings.alwaysShowDisabledChoices?(a=document.createElement("li"),a.innerHTML=e.parsedText,i.push(t.appendChild(a))):i.push(void 0)):i.push(void 0);return i},e.updateInventories=function(){var e,t,n,s,a,r,i,o,l,u;for(this.resetInventories(),n=document.getElementById("novel-inventory"),e=document.getElementById("novel-hidden-inventory"),o=novelData.novel.inventories[novelData.novel.currentInventory],l=[],a=0,r=o.length;r>a;a++)s=o[a],u=e,s.hidden&&void 0!==s.hidden||(u=n),s.value>0||isNaN(s.value)?(i=document.createElement("li"),i["class"]="novel-inventory-item",t=LanguageManager.getItemAttribute(s,"displayName")+" - "+s.value,t+='<ul class="novel-inventory-item-info">',s.description&&(t=t+'<li class="novel-inventory-item-description">'+LanguageManager.getItemAttribute(s,"description")+"</li>"),t+="</ul>",i.innerHTML=t,l.push(u.appendChild(i))):l.push(void 0);return l},e}(),Util=function(){function e(){return t?t:void(t=this)}var t;return t=null,e.isEven=function(e){return e%2===0},e.isOdd=function(e){return 1===Math.abs(e%2)},e.stripHTML=function(e){var t;return t=/(<([^>]+)>)/gi,e.replace(t,"")},e.checkFormat=function(e,t){return"array"===t?"[object Array]"===Object.prototype.toString.call(e)?!0:(console.error("ERROR: Invalid input format (should be "+t+")"),!1):"arrayOrString"===t?"[object Array]"===Object.prototype.toString.call(e)||"string"==typeof e?!0:(console.error("ERROR: Invalid input format (should be "+t+")"),!1):typeof e===t?!0:(console.error("ERROR: Invalid input format (should be "+t+")"),!1)},e.validateParentheses=function(e){var t,n,s,a;for(a=0,n=0,s=e.length;s>n;n++)if(t=e[n],"("===t&&a++,")"===t){if(!(a>0))return!1;a--}return 0===a},e.validateTagParentheses=function(e){var t,n,s,a,r;for(r=0,n=0,s=0,a=e.length;a>s;s++){if(t=e[s],"["===t&&(e[n-1]?"/"!==e[n-1]&&r++:r++),"]"===t)if(e[n-1]){if("/"!==e[n-1]){if(!(r>0))return!1;r--}}else{if(!(r>0))return!1;r--}n++}return 0===r},e.mergeObjArrays=function(e,t){var n,s;return s={},e.concat(t).forEach(function(e){var t,n,a;if(n=e.name,a=s[n],!a)return void(s[n]=e);for(t in e)a[t]=e[t]}),n=Object.keys(s).map(function(e){return s[e]})},e}(),novelData={novel:null,choices:null,debugMode:!1,status:"Loading",inventoryHidden:!1,choicesHidden:!1,printedText:"",parsedJavascriptCommands:[],music:[],csvEnabled:!1,markdownEnabled:!1},novelPath="./novel","undefined"!=typeof Papa&&(novelData.csvEnabled=!0),"undefined"!=typeof marked&&(novelData.markdownEnabled=!0),NovelManager.start();